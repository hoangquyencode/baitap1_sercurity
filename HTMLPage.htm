<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Caesar Cipher — Mã hóa / Giải mã</title>
  <style>
    body { font-family: system-ui, Arial; background:#f7f8fb; color:#111; padding:28px; }
    .card { max-width:860px; margin:0 auto; background:#fff; border-radius:12px; box-shadow:0 8px 30px rgba(20,30,50,0.06); padding:22px; }
    h1 { margin:0 0 14px; font-size:22px; }
    label { display:block; margin-top:12px; font-weight:700; }
    textarea { width:100%; min-height:120px; padding:12px; border-radius:8px; border:1px solid #e5e7eb; resize:vertical; font-size:15px; }
    input[type="number"] { padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb; width:120px; }
    .row { display:flex; gap:10px; margin-top:14px; flex-wrap:wrap; }
    button { padding:10px 14px; border-radius:10px; border:0; cursor:pointer; font-weight:700; }
    .btn-primary { background:#2563eb; color:#fff; }
    .btn-ghost { background:#eef2ff; color:#111; }
    pre { white-space:pre-wrap; background:#0b1220; color:#e6eef8; padding:14px; border-radius:8px; margin-top:12px; }
    .small { font-size:13px; color:#556; margin-top:8px; }
    .brute-list { max-height:260px; overflow:auto; padding:10px; border-radius:8px; border:1px dashed #e6eef2; background:#fff; margin-top:8px; }
    .kbd { background:#f1f5f9; padding:6px 8px; border-radius:6px; font-weight:600; display:inline-block; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Caesar Cipher — Mã hóa / Giải mã</h1>

    <label for="inputText">Văn bản</label>
    <textarea id="inputText" placeholder="Ví dụ: hôm nay mệt quá"></textarea>

    <label for="key">Khóa (k)</label>
    <input id="key" type="number" value="3" />

    <div class="row">
      <button class="btn-primary" id="encryptBtn">Mã hóa</button>
      <button class="btn-primary" id="decryptBtn">Giải mã</button>
      <button class="btn-ghost" id="bruteBtn">Brute-force</button>
      <button id="clearBtn" class="btn-ghost">Xóa</button>
    </div>

    <div style="margin-top:16px;">
      <label>Kết quả</label>
      <pre id="output">—</pre>
      <div class="small">Lưu ý: <strong>chữ có dấu (ví dụ tiếng Việt)</strong>, số, dấu cách và ký tự đặc biệt được giữ nguyên. Chỉ chữ A–Z / a–z được dịch chuyển.</div>
    </div>

    <div id="bruteArea" style="display:none;">
      <label style="margin-top:12px">Kết quả Brute-force (k = 0..25)</label>
      <div class="brute-list" id="bruteList"></div>
    </div>
  </div>

<script>
  // Chuẩn hóa k về [0,25]
  function normK(k) {
    k = Number(k) || 0;
    return ((k % 26) + 26) % 26;
  }

  // Dịch 1 ký tự nếu là A-Z hoặc a-z, giữ nguyên ký tự khác
  function shiftCharLatin(ch, k) {
    const code = ch.charCodeAt(0);
    // A-Z
    if (code >= 65 && code <= 90) {
      return String.fromCharCode((code - 65 + k) % 26 + 65);
    }
    // a-z
    if (code >= 97 && code <= 122) {
      return String.fromCharCode((code - 97 + k) % 26 + 97);
    }
    // nếu không phải bảng latin a-z, giữ nguyên (bao gồm chữ có dấu)
    return ch;
  }

  // Hàm chính: chỉ áp dụng cho chữ latin không dấu
  function caesarShift(text, k) {
    k = normK(k);
    let out = "";
    for (let i = 0; i < text.length; ++i) {
      out += shiftCharLatin(text[i], k);
    }
    return out;
  }

  // Encrypt / Decrypt wrapper
  function caesarEncrypt(text, k) { return caesarShift(text, k); }
  function caesarDecrypt(text, k) { return caesarShift(text, -k); }

  // Elements
  const inputText = document.getElementById('inputText');
  const keyInput = document.getElementById('key');
  const output = document.getElementById('output');
  const bruteArea = document.getElementById('bruteArea');
  const bruteList = document.getElementById('bruteList');

  document.getElementById('encryptBtn').addEventListener('click', () => {
    bruteArea.style.display = 'none';
    const txt = inputText.value;
    const k = keyInput.value;
    output.textContent = caesarEncrypt(txt, k);
  });

  document.getElementById('decryptBtn').addEventListener('click', () => {
    bruteArea.style.display = 'none';
    const txt = inputText.value;
    const k = keyInput.value;
    output.textContent = caesarDecrypt(txt, k);
  });

  document.getElementById('bruteBtn').addEventListener('click', () => {
    bruteArea.style.display = 'block';
    bruteList.innerHTML = '';
    const cipher = inputText.value;
    for (let kk = 0; kk < 26; ++kk) {
      const plain = caesarDecrypt(cipher, kk);
      const item = document.createElement('div');
      item.textContent = kk + " : " + plain;
      bruteList.appendChild(item);
    }
    output.textContent = 'Brute-force hoàn tất — xem danh sách phía dưới.';
  });

  document.getElementById('clearBtn').addEventListener('click', () => {
    inputText.value = '';
    output.textContent = '—';
    bruteArea.style.display = 'none';
    keyInput.value = 3;
  });

  // Tùy chọn: tự điền ví dụ
  // inputText.value = "hôm nay mệt quá";
</script>
</body>
</html>
